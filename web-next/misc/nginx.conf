# Nginx configuration for ZoneMinder Next-Gen Web UI
# Include this in your server block.
#
# Assumes ZoneMinder API is at /zm/api/

location /zm-next/ {
    alias /usr/share/zoneminder/web-next/;
    try_files $uri $uri/ /zm-next/index.html;
}

# Proxy API requests to ZoneMinder backend
location /zm-next/api/ {
    rewrite ^/zm-next/api/(.*)$ /zm/api/$1 break;
    proxy_pass http://127.0.0.1:80;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}

# WebSocket proxy for go2rtc streams
location /go2rtc/ {
    proxy_pass http://127.0.0.1:1984/;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
}
